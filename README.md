# ูุญููู PDF ุนุฑุจู ุฐูู ุฅูู ูุงุฑูุฏุงูู

ูุฐุง ุงููุดุฑูุน ูู ุฎุท ุฃูุงุจูุจ ูุชูุฏู ูุชุญููู ูููุงุช PDF ุงูุชุนููููุฉ ุจุงููุบุฉ ุงูุนุฑุจูุฉ ุฅูู ูููุงุช Markdown (MD) ููุธูุฉ. ูุณุชุฎุฏู ุงูุณูุฑูุจุช ููุงุฐุฌ ูุบููุฉ ูุจูุฑุฉ (LLM) ูุชุนุฏุฏุฉ ุงููุณุงุฆุท ูุชุญููู ุตูุฑ ุตูุญุงุช PDFุ ุงุณุชุฎุฑุงุฌ ุงููุตูุตุ ุชุญุฏูุฏ ุงูุตูุฑ ุงููุงูุฉุ ูุฅูุดุงุก ูุญุชูู ูุตู ูุตูู ููุงุ ูุน ุงูุญูุงุธ ุนูู ุจููุฉ ููุทููุฉ ูููุญุชูู.

---

<div dir="rtl">

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุงููุฏู ุงูุฃุณุงุณู ููุฐุง ุงููุดุฑูุน ูู ุฃุชูุชุฉ ุนูููุฉ ุชุญููู ุงูููุงุฏ ุงูุชุนููููุฉ ุงููุทุจูุนุฉ (PDF) ุฅูู ุตูุบุฉ ุฑูููุฉ ูุฑูุฉ ููุงุจูุฉ ููุชุญุฑูุฑ (Markdown). ูุฐุง ูุณูู ุฃุฑุดูุฉ ุงููุญุชููุ ุงูุจุญุซ ูููุ ูุฅุนุงุฏุฉ ุงุณุชุฎุฏุงูู ูู ููุตุงุช ุงูุชุนููู ุงูุฅููุชุฑููู. ุงูุณูุฑูุจุช ูุตูู ุฎุตูุตุงู ููุชุนุงูู ูุน ุชุญุฏูุงุช ุงููุญุชูู ุงูุนุฑุจูุ ูุซู ุงุชุฌุงู ุงููุต ูุงูุตูุฑ ุงููุชุฏุงุฎูุฉ.

## โจ ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ

- **ูุนุงูุฌุฉ ุตูุฑ ุงูุตูุญุงุช**: ูููู ุจุชูููุฉ ูู ุตูุญุฉ (ุฅุฒุงูุฉ ุงููููุงูุ ุชูููู ุงูุชุดููุดุ ุชุญุณูู ุงูุชุจุงูู) ูุฒูุงุฏุฉ ุฏูุฉ ุงูุชุนุฑู ุนูู ุงููุตูุต (OCR).
- **ุงุณุชุฎุฑุงุฌ ุฐูู ููุตูุฑ**: ูููุฒ ุจูู ุงูุตูุฑ ุงูุชูุถูุญูุฉ ุงููุงูุฉ (ูุซู ุงูุฑุณูู ุงูุจูุงููุฉ ูุงูุฎุฑุงุฆุท) ูุงูุนูุงุตุฑ ุงูุฒุฎุฑููุฉ (ูุซู ุงูุฃููููุงุช ูุงูุฅุทุงุฑุงุช)ุ ููุชุฌุงูู ุงูุฃุฎูุฑุฉ.
- **ุชุญููู ุจูุงุณุทุฉ ุงูุฐูุงุก ุงูุงุตุทูุงุนู**: ูุฑุณู ุตูุฑุฉ ุงูุตูุญุฉ ูุงูุตูุฑ ุงููุณุชุฎุฑุฌุฉ ุฅูู ูููุฐุฌ `Gemini 2.5 Pro` ูุชุญููู ุดุงูู.
- **ุชูููุฏ ูุญุชูู ูุตูู**: ูููู ุงููููุฐุฌ ุงููุบูู ุจุชูููุฏ ุฃูุตุงู ุนุฑุจูุฉ ููุตูุฑ ุงููุงูุฉ ููุฏูุฌูุง ูู ููู ุงููุงุฑูุฏุงูู.
- **ุงุณุชุฎุฑุงุฌ ุงูุจูุงูุงุช ุงููุตููุฉ**: ูุชุนุฑู ุนูู ุงุณู ุงููุญุฏุฉุ ุนููุงู ุงูุฏุฑุณุ ูุฑูู ุงูุฏุฑุณ ูู ุงูุตูุญุฉ.
- **ูููู ูุฎุฑุฌุงุช ููุธู**: ููุดุฆ ูุฌูุฏุงู ุฎุงุตุงู ููู ููู PDF ูุน ูุฌูุฏุงุช ูุฑุนูุฉ ูููุญุชูู ูุงูุตูุฑุ ููุง ูุถูู ุชูุธูู ุงููุดุฑูุน.
- **ูุงุฌูุฉ ุณุทุฑ ุงูุฃูุงูุฑ (CLI)**: ูููุฑ ูุงุฌูุฉ ูุฑูุฉ ููุชุญูู ูู ุงููุนุงูุฌุฉุ ูุซู ุชุญุฏูุฏ ูุฌูุฏุงุช ุงููุฏุฎูุงุช ูุงููุฎุฑุฌุงุช.

## โ๏ธ ุขููุฉ ุงูุนูู

ูุนูู ุงูุณูุฑูุจุช ุนุจุฑ ุณูุณูุฉ ูู ุงูุฎุทูุงุช ุงูููุธูุฉ ููู ุตูุญุฉ ูู ููู PDF:

1.  **ุชุญููู PDF ุฅูู ุตูุฑ**: ูุชู ุชุญููู ูู ุตูุญุฉ ูู ููู PDF ุฅูู ุตูุฑุฉ ุนุงููุฉ ุงูุฏูุฉ (PNG).
2.  **ูุนุงูุฌุฉ ุงูุตูุฑุฉ ุงูุฑุฆูุณูุฉ**: ุชุฎุถุน ุตูุฑุฉ ุงูุตูุญุฉ ูุนูููุงุช ุชุญุณูู ูุถูุงู ุฃูุตู ูุถูุญ ูููุต.
3.  **ุงุณุชุฎุฑุงุฌ ุงูุตูุฑ ุงููุฑุนูุฉ**: ูุชู ุงุณุชุฎุฑุงุฌ ุฌููุน ุงูุตูุฑ ุงููุถููุฉ ูู ุงูุตูุญุฉ ุงูุฃุตููุฉ ุจุงุณุชุฎุฏุงู PyMuPDF.
4.  **ุงูุชุญููู ุนุจุฑ LLM**: ุชูุฑุณู ุตูุฑุฉ ุงูุตูุญุฉ ุงูููุญุณูููุฉ ูุงูุตูุฑ ุงููุฑุนูุฉ ุงููุณุชุฎุฑุฌุฉ ุฅูู Gemini API.
5.  **ุชูููุฏ ุงููุงุฑูุฏุงูู**: ูููู ุงููููุฐุฌ ุจุชุญููู ุงููุญุชููุ ูุชุงุจุฉ ุงููุตุ ุชูููู ุงูุตูุฑุ ูุชุงุจุฉ ุฃูุตุงู ููุตูุฑ ุงููุงูุฉุ ูุชูุณูู ูู ุฐูู ูู ูุงุฆู JSON.
6.  **ุญูุธ ูุชูุธูู**: ูุชู ุญูุธ ูุญุชูู ุงููุงุฑูุฏุงูู ูู ููู `.md`ุ ููุชู ุญุฐู ุงูุตูุฑ ุงูุชู ุงุนุชุจุฑูุง ุงููููุฐุฌ ุฒุฎุฑููุฉ ุฃู ุบูุฑ ุถุฑูุฑูุฉ ููุญูุงุธ ุนูู ูุธุงูุฉ ุงููุฎุฑุฌุงุช.

## ๐ ุงูุฅุนุฏุงุฏ ูุงูุชุดุบูู

ุงุชุจุน ูุฐู ุงูุฎุทูุงุช ูุฅุนุฏุงุฏ ุงููุดุฑูุน ูุชุดุบููู ุนูู ุฌูุงุฒู.

### 1. ุงููุชุทูุจุงุช ุงูุฃุณุงุณูุฉ

- **Python 3.8+**
- **ููุชุงุญ API**: ุชุญุชุงุฌ ุฅูู ููุชุงุญ API ูู [OpenRouter.ai](https://openrouter.ai/) ูููุตูู ุฅูู ูููุฐุฌ Gemini.
- **Poppler**: ูุฐู ููุชุจุฉ ุฎุงุฑุฌูุฉ ุถุฑูุฑูุฉ ูุนูู `pdf2image`.

    - **ุนูู Windows**:
        1.  ุญููู ุฃุญุฏุซ ูุณุฎุฉ ูู [Poppler for Windows](https://github.com/oschwartz10612/poppler-windows/releases/).
        2.  ูู ุถุบุท ุงูููู ูุฃุถู ูุณุงุฑ ูุฌูุฏ `bin` ุฅูู ูุชุบูุฑุงุช ุงูุจูุฆุฉ `Path`.

    - **ุนูู macOS** (ุจุงุณุชุฎุฏุงู Homebrew):
        ```bash
        brew install poppler
        ```
    - **ุนูู Linux** (Debian/Ubuntu):
        ```bash
        sudo apt-get update && sudo apt-get install poppler-utils
        ```

### 2. ุฎุทูุงุช ุงูุชุซุจูุช

1.  **ุงุณุชูุณุฎ ุงููุณุชูุฏุน (Clone the repository):**
    ```bash
    git clone [your-repository-url]
    cd [repository-folder]
    ```

2.  **ุซุจูุช ุงูููุชุจุงุช ุงููุทููุจุฉ:**
    ```bash
    pip install -r requirements.txt
    ```

3.  **ูู ุจุฅุนุฏุงุฏ ูุชุบูุฑุงุช ุงูุจูุฆุฉ:**
    -   ุฃูุดุฆ ูููุงู ุฌุฏูุฏุงู ุจุงุณู `.env` ูู ุงููุฌูุฏ ุงูุฑุฆูุณู ูููุดุฑูุน.
    -   ุฃุถู ููุชุงุญ API ุงูุฎุงุต ุจู ุฏุงุฎู ุงูููู ุจูุฐุง ุงูุดูู:
        ```
        OPENROUTER_API_KEY="sk-or-..."
        ```

### 3. ุทุฑููุฉ ุงูุงุณุชุฎุฏุงู

1.  ุถุน ุฌููุน ูููุงุช PDF ุงูุชู ุชุฑูุฏ ูุนุงูุฌุชูุง ุฏุงุฎู ูุฌูุฏ `pdfs`. ุฅุฐุง ูู ููู ููุฌูุฏุงูุ ูู ุจุฅูุดุงุฆู.
2.  ูู ุจุชุดุบูู ุงูุณูุฑูุจุช ูู ุณุทุฑ ุงูุฃูุงูุฑ.

    **ุฃุจุณุท ุฃูุฑ ููุชุดุบูู:**
    ```bash
    python ocr_smart_arabic_v9.py
    ```

    **ุฃูุฑ ูุน ุฎูุงุฑุงุช ูุฎุตุตุฉ:**
    ```bash
    python ocr_smart_arabic_v9.py --pdf-dir "my_books" --output-dir "results" --dpi 300 --save-processed-scans
    ```

### 4. ุฎูุงุฑุงุช ุณุทุฑ ุงูุฃูุงูุฑ

-   `--pdf-dir`: ุงููุฌูุฏ ุงูุฐู ูุญุชูู ุนูู ูููุงุช PDF (ุงูุงูุชุฑุงุถู: `pdfs`).
-   `--output-dir`: ุงููุฌูุฏ ุงูุฑุฆูุณู ูุญูุธ ุฌููุน ุงููุฎุฑุฌุงุช (ุงูุงูุชุฑุงุถู: `output`).
-   `--dpi`: ุงูุฏูุฉ (DPI) ุงููุณุชุฎุฏูุฉ ูุชุญููู PDF ุฅูู ุตูุฑ (ุงูุงูุชุฑุงุถู: `300`).
-   `--api-key`: ูุชูุฑูุฑ ููุชุงุญ API ูุจุงุดุฑุฉ (ูุชุฌุงูุฒ ูุชุบูุฑ ุงูุจูุฆุฉ).
-   `--clear-output`: ูุญุฐู ูุฌูุฏ ุงููุฎุฑุฌุงุช ุงูุฑุฆูุณู ูุจู ุงูุจุฏุก ูู ุฌุฏูุฏ.
-   `--save-processed-scans`: ูุญูุธ ุตูุฑ ุงูุตูุญุงุช ุจุนุฏ ูุนุงูุฌุชูุง (ูุฃุบุฑุงุถ ุงููุฑุงุฌุนุฉ ูุงูุชุตุญูุญ).

## ๐ ูููู ุงููุฎุฑุฌุงุช

ููู ููู PDF ุชุชู ูุนุงูุฌุชูุ ุณูุชู ุฅูุดุงุก ุงููููู ุงูุชุงูู ุฏุงุฎู ูุฌูุฏ `output`:

```
output/
โโโ ุงุณู_ููู_PDF/
    โโโ illustrative_images/
    โ   โโโ page_1/
    โ   โ   โโโ img_0.png
    โ   โโโ page_2/
    โ       โโโ img_0.png
    โ       โโโ img_1.png
    โโโ markdown_content/
    โ   โโโ Unit_ุงููุญุฏุฉ_ุงูุฃููู_Lesson_ุงูุฏุฑุณ_ุงูุฃูู_ุนููุงู_ุงูุฏุฑุณ.md
    โโโ processed_page_scans/  (ุฅุฐุง ุชู ุชูุนููู)
        โโโ scan_page_1.png
        โโโ scan_page_2.png
```

## ๐ ุงูุชุฑุฎูุต

ูุฐุง ุงููุดุฑูุน ูุฑุฎุต ุชุญุช ุฑุฎุตุฉ MIT.

</div>

---

# Smart Arabic PDF to Markdown Converter

This project is an advanced pipeline for converting Arabic educational PDF files into structured Markdown (MD) files. The script utilizes a multimodal Large Language Model (LLM) to analyze PDF page images, extract text, identify important images, and generate descriptive content for them, all while maintaining a logical content structure.

---

<div dir="ltr">

## ๐ Overview

The primary goal of this project is to automate the conversion of printed educational materials (PDF) into a flexible and editable digital format (Markdown). This facilitates content archiving, searching, and reuse in e-learning platforms. The script is specifically designed to handle the challenges of Arabic content, such as right-to-left text direction and nested images.

## โจ Key Features

- **Page Image Pre-processing**: Cleans each page (deskew, denoise, enhance contrast) to improve Optical Character Recognition (OCR) accuracy.
- **Intelligent Image Extraction**: Differentiates between important illustrative images (like diagrams and maps) and decorative elements (like icons and borders), ignoring the latter.
- **AI-Powered Analysis**: Sends the page image and extracted sub-images to the `Gemini 2.5 Pro` model for a comprehensive analysis.
- **Descriptive Content Generation**: The LLM generates Arabic descriptions for important images and integrates them into the Markdown file.
- **Metadata Extraction**: Identifies the unit name, lesson title, and lesson number from the page.
- **Organized Output Structure**: Creates a dedicated folder for each PDF with clear subdirectories for content and images, ensuring a tidy project.
- **Command-Line Interface (CLI)**: Provides a flexible interface to control the processing, such as specifying input and output directories.

## โ๏ธ How It Works

The script operates through a structured pipeline for each page in the PDF file:

1.  **PDF to Image Conversion**: Each PDF page is converted into a high-resolution image (PNG).
2.  **Main Image Pre-processing**: The page image undergoes enhancement operations to ensure maximum text clarity.
3.  **Sub-Image Extraction**: All embedded images are extracted from the original page using PyMuPDF.
4.  **LLM Analysis**: The processed page image and the extracted sub-images are sent to the Gemini API.
5.  **Markdown Generation**: The model analyzes the content, transcribes the text, evaluates the images, writes captions for the important ones, and formats everything into a JSON object.
6.  **Saving and Cleanup**: The Markdown content is saved to a `.md` file, and images deemed decorative or unnecessary by the model are deleted to keep the output clean.

## ๐ Setup and Usage

Follow these steps to set up and run the project on your machine.

### 1. Prerequisites

- **Python 3.8+**
- **API Key**: You will need an API key from [OpenRouter.ai](https://openrouter.ai/) to access the Gemini model.
- **Poppler**: This is an external dependency required by `pdf2image`.

    - **On Windows**:
        1.  Download the latest release from [Poppler for Windows](https://github.com/oschwartz10612/poppler-windows/releases/).
        2.  Unzip the file and add the path to the `bin` folder to your system's `Path` environment variable.

    - **On macOS** (using Homebrew):
        ```bash
        brew install poppler
        ```
    - **On Linux** (Debian/Ubuntu):
        ```bash
        sudo apt-get update && sudo apt-get install poppler-utils
        ```

### 2. Installation Steps

1.  **Clone the repository:**
    ```bash
    git clone [your-repository-url]
    cd [repository-folder]
    ```

2.  **Install the required libraries:**
    ```bash
    pip install -r requirements.txt
    ```

3.  **Set up environment variables:**
    -   Create a new file named `.env` in the project's root directory.
    -   Add your API key to the file in this format:
        ```
        OPENROUTER_API_KEY="sk-or-..."
        ```

### 3. How to Use

1.  Place all the PDF files you want to process inside the `pdfs` directory. If it doesn't exist, create it.
2.  Run the script from your command line.

    **Simplest command to run:**
    ```bash
    python ocr_smart_arabic_v9.py
    ```

    **Command with custom options:**
    ```bash
    python ocr_smart_arabic_v9.py --pdf-dir "my_books" --output-dir "results" --dpi 300 --save-processed-scans
    ```

### 4. Command-Line Arguments

-   `--pdf-dir`: The directory containing the PDF files (Default: `pdfs`).
-   `--output-dir`: The main directory to save all outputs (Default: `output`).
-   `--dpi`: The resolution (DPI) to use for converting PDF to images (Default: `300`).
-   `--api-key`: Pass the API key directly (overrides the environment variable).
-   `--clear-output`: Delete the main output directory before starting.
-   `--save-processed-scans`: Enable saving the processed (B&W) page images for review.

## ๐ Output Structure

For each processed PDF, the following structure will be created inside the `output` directory:

```
output/
โโโ PDF_FILENAME/
    โโโ illustrative_images/
    โ   โโโ page_1/
    โ   โ   โโโ img_0.png
    โ   โโโ page_2/
    โ       โโโ img_0.png
    โ       โโโ img_1.png
    โโโ markdown_content/
    โ   โโโ Unit_UnitOne_Lesson_LessonOne_LessonTitle.md
    โโโ processed_page_scans/  (if enabled)
        โโโ scan_page_1.png
        โโโ scan_page_2.png
```

## ๐ License

This project is licensed under the MIT License.

</div>